

   MEMBER('svc.clw')                                       ! This is a MEMBER module

                     MAP
                       INCLUDE('SVC003.INC'),ONCE        !Local module procedure declarations
                     END


ServiceHandlerExA    PROCEDURE  ( Ulong pdwControl, Ulong pdwEventType, Long plpEventData, Long plpContext ) ! Declare Procedure
  CODE
!( Ulong pdwControl, Ulong pdwEventType, Long plpEventData, Long plpContext ), Ulong, Pascal
!
!DWORD LphandlerFunctionEx(
!  [in] DWORD dwControl,
!  [in] DWORD dwEventType,
!  [in] LPVOID lpEventData,
!  [in] LPVOID lpContext
!)
!{...}
    Case pdwControl

    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_STOP              ! Stop the service and return NO_ERROR

    GSS:dwCurrentState              = ISEQ:SetServiceStatus:CurrentState:SERVICE_STOP_PENDING

    GLO:RVBool = ISWA_SetServiceStatus(  GLLA:SetServiceStatus, GSCV:ServiceCtrlHandlerHandle, Address( GSS:ServiceStatus ) )
    !success = UpdateSCMStatus(SERVICE_START_PENDING, NO_ERROR, 0, 1, 5000)

    IF NOT GLO:RVBool

        Return

    End

    Glo:RVBool = ISWA_SetEvent( GLLA:SetEvent, GSCV:EventKillService )
    Return


!    serviceStatus.dwCurrentState = SERVICE_STOP_PENDING;
!SetServiceStatus( serviceStatusHandle, &serviceStatus );
!SetEvent( stopServiceEvent );
!return;
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_PAUSE             ! Pause the service
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_CONTINUE          ! Resume a paused service
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_INTERROGATE       ! Request service status; return NO_ERROR
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_SHUTDOWN          ! System shutdown; cleanup and stop service
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_PARAMCHANGE       ! Reread service-specific startup parameters
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_NETBINDADD        ! Bind to new network component (use Plug and Play)
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_NETBINDREMOVE     ! Unbind removed network component (use Plug and Play)
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_NETBINDENABLE     ! Add enabled network binding (use Plug and Play)
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_NETBINDDISABLE    ! Remove disabled network binding (use Plug and Play)
    OF ISEQ:ServiceHandlerExA:SERVICE_CONTROL_PRESHUTDOWN       ! Pre-shutdown cleanup; blocks shutdown until complete
    Else
    End
